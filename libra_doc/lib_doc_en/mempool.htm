<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Mempool · Libra</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="Mempool is a memory-buffer that holds the transactions that are waiting to be executed."/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Mempool · Libra"/><meta property="og:type" content="website"/><meta property="og:url" content="https://developers.libra.org/"/><meta property="og:description" content="Mempool is a memory-buffer that holds the transactions that are waiting to be executed."/><meta property="og:image" content="https://developers.libra.org/img/libra.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://developers.libra.org/img/libra.png"/><link rel="shortcut icon" href="libra.ico"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><link rel="alternate" type="application/atom+xml" href="atom.xml" title="Libra Blog ATOM Feed"/><link rel="alternate" type="application/rss+xml" href="feed.xml" title="Libra Blog RSS Feed"/><script type="text/javascript" src="buttons.js"></script><script type="text/javascript" src="code_block_buttons.js"></script><script type="text/javascript" src="cookie_banner.js"></script><script type="text/javascript" src="disable_adblock.js"></script><script type="text/javascript" src="segment.analytics.min.js"></script><script type="text/javascript" src="segment.js"></script><script type="text/javascript" src="clipboardjs.2.0.0.min.js"></script><script type="text/javascript" src="forms.js"></script><script src="scrollSpy.js"></script><link rel="stylesheet" href="main.css"/><script src="codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="https://developers.libra.org/"><img class="logo" src="libra-nav-logo.png" alt="Libra"/><h2 class="headerTitleWithLogo">Libra</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="https://violas.io/">Home</a></li><li class="siteNavGroupActive"><a href="welcome-to-libra.htm" target="_self">Documentation</a></li><li class=""><a href="https://community.libra.org" target="_self">Community</a></li><li class=""><a href="blog_2.html" target="_self">Blog</a></li><li class=""><a href="https://libra.org" target="_self">libra.org</a></li><li class=""><a href="https://github.com/libra/libra" target="_self">GitHub</a></li><li class=""><a href="../lib_doc_en2cn/mempool.htm">中/EN</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>READMEs</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Learn About Libra</h3><ul class=""><li class="navListItem"><a class="navItem" href="welcome-to-libra.htm">Welcome</a></li><li class="navListItem"><a class="navItem" href="libra-protocol.htm">Libra Protocol: Key Concepts</a></li><li class="navListItem"><a class="navItem" href="life-of-a-transaction.htm">Life of a Transaction</a></li><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Technical Papers</h4><ul><li class="navListItem"><a class="navItem" href="the-libra-blockchain-paper.htm">The Libra Blockchain</a></li><li class="navListItem"><a class="navItem" href="move-paper.htm">Move: A Language With Programmable Resources</a></li><li class="navListItem"><a class="navItem" href="state-machine-replication-paper.htm">State Machine Replication in the Libra Blockchain</a></li></ul></div></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Try Libra Core</h3><ul class=""><li class="navListItem"><a class="navItem" href="my-first-transaction.htm">My First Transaction</a></li><li class="navListItem"><a class="navItem" href="move-overview.htm">Getting Started With Move</a></li><li class="navListItem"><a class="navItem" href="run-local-network.htm">Run a Local Network</a></li><li class="navListItem"><a class="navItem" href="run-move-locally.htm">Run Move Programs Locally</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Community</h3><ul class=""><li class="navListItem"><a class="navItem" href="libra-open-source-paper.htm">Libra Open Source</a></li><li class="navListItem"><a class="navItem" href="contributing.htm">Contribution Guide</a></li><li class="navListItem"><a class="navItem" href="coding-guidelines.htm">Coding Guidelines</a></li><li class="navListItem"><a class="navItem" href="security.htm">Reporting Vulnerabilities</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Libra Codebase</h3><ul class=""><li class="navListItem"><a class="navItem" href="libra-core-overview.htm">Libra Core Overview</a></li><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">READMEs</h4><ul><li class="navListItem"><a class="navItem" href="admission-control.htm">Admission Control</a></li><li class="navListItem"><a class="navItem" href="bytecode-verifier.htm">Bytecode Verifier</a></li><li class="navListItem"><a class="navItem" href="consensus.htm">Consensus</a></li><li class="navListItem"><a class="navItem" href="crypto.htm">Crypto</a></li><li class="navListItem"><a class="navItem" href="execution.htm">Execution</a></li><li class="navListItem navListItemActive"><a class="navItem" href="mempool.htm">Mempool</a></li><li class="navListItem"><a class="navItem" href="ir-to-bytecode.htm">Move IR Compiler</a></li><li class="navListItem"><a class="navItem" href="move-language.htm">Move Language</a></li><li class="navListItem"><a class="navItem" href="network.htm">Network</a></li><li class="navListItem"><a class="navItem" href="storage.htm">Storage</a></li><li class="navListItem"><a class="navItem" href="vm.htm">Virtual Machine</a></li></ul></div></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Reference</h3><ul class=""><li class="navListItem"><a class="navItem" href="libra-cli.htm">Libra CLI</a></li><li class="navListItem"><a class="navItem" href="glossary.htm">Glossary</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="https://github.com/libra/libra/edit/master/mempool/README.md" target="_blank" rel="noreferrer noopener">Edit</a><h1 class="postHeaderTitle">Mempool</h1></header><article><div><span><p>Mempool is a memory-buffer that holds the transactions that are waiting to be executed.</p>
<h2><a class="anchor" aria-hidden="true" id="overview"></a><a href="mempool.htm#overview" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Overview</h2>
<p>Admission control (AC) module sends transactions to mempool. Mempool holds the transactions for a period of time, before consensus commits them. When a new transaction is added, mempool shares this transaction with other validators (validator nodes) in the system. Mempool is a “shared mempool,” as transactions between mempools are shared with other validators. This helps maintain a pseudo-global ordering.</p>
<p>When a validator receives a transaction from another mempool, the transaction is ordered when it’s added to the ordered queue of the recipient validator. To reduce network consumption in the shared mempool, each validator is responsible for the delivery of its own transactions. We don't rebroadcast transactions originating from a peer validator.</p>
<p>We only broadcast transactions that have some probability of being included in the next block. This means that either the sequence number of the transaction is the next sequence number of the sender account, or it is sequential to it. For example, if the current sequence number for an account is 2 and local mempool contains transactions with sequence numbers 2, 3, 4, 7, 8, then only transactions 2, 3, and 4 will be broadcast.</p>
<p>The consensus module pulls transactions from mempool, mempool does not push transactions into consensus. This is to ensure that while consensus is not ready for transactions:</p>
<ul>
<li>Mempool can continue ordering transactions based on gas; and</li>
<li>Consensus can allow transactions to build up in the mempool.</li>
</ul>
<p>This allows transactions to be grouped into a single consensus block, and prioritized by gas price.</p>
<p>Mempool doesn't keep track of transactions sent to consensus. On each get_block request (to pull a block of transaction from mempool), consensus sends a set of transactions that were pulled from mempool, but not committed. This allows the mempool to stay agnostic about different consensus proposal branches.</p>
<p>When a transaction is fully executed and written to storage, consensus notifies mempool. Mempool then drops this transaction from its internal state.</p>
<h2><a class="anchor" aria-hidden="true" id="implementation-details"></a><a href="mempool.htm#implementation-details" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Implementation Details</h2>
<p>Internally, mempool is modeled as <code>HashMap&lt;AccountAddress, AccountTransactions&gt;</code> with various indexes built on top of it.</p>
<p>The main index - PriorityIndex is an ordered queue of transactions that are “ready” to be included in the next block (i.e., they have a sequence number which is sequential to the current sequence number for the account). This queue is ordered by gas price so that if a client is willing to pay more (than other clients) per unit of execution, then they can enter consensus earlier.</p>
<p>Note that, even though global ordering is maintained by gas price, for a single account, transactions are ordered by sequence number. All transactions that are not ready to be included in the next block are part of a separate ParkingLotIndex. They are moved to the ordered queue once some event unblocks them.</p>
<p>Here is an example: mempool has a transaction with sequence number 4, while the current sequence number for that account is 3. This transaction is considered “non-ready.” Callback from consensus notifies that transaction was committed (i.e., transaction 3 was submitted to a different node and has hence been committed on chain). This event “unblocks” the local transaction, and transaction #4 is moved to the OrderedQueue.</p>
<p>Mempool only holds a limited number of transactions to avoid overwhelming the system and to prevent abuse and attack. Transactions in Mempool have two types of expirations: systemTTL and client-specified expiration. When either of these is reached, the transaction is removed from Mempool.</p>
<p>SystemTTL is checked periodically in the background, while the expiration specified by the client is checked on every Consensus commit request. We use a separate system TTL to ensure that a transaction doesn’t remain stuck in the Mempool forever, even if Consensus doesn't make progress.</p>
<h2><a class="anchor" aria-hidden="true" id="how-is-this-module-organized"></a><a href="mempool.htm#how-is-this-module-organized" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>How is this module organized?</h2>
<pre><code class="hljs">    mempool/src
    ├── core_mempool             # main in memory data structure
    ├── proto                    # protobuf definitions for interactions with mempool
    ├── lib.rs
    ├── mempool_service.rs       # gRPC service
    ├── runtime.rs               # bundle of shared mempool and gRPC service
    └── shared_mempool.rs        # shared mempool
</code></pre>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="execution.htm"><span class="arrow-prev">← </span><span>Execution</span></a><a class="docs-next button" href="ir-to-bytecode.htm"><span>Move IR Compiler</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="mempool.htm#overview">Overview</a></li><li><a href="mempool.htm#implementation-details">Implementation Details</a></li><li><a href="mempool.htm#how-is-this-module-organized">How is this module organized?</a></li></ul></nav></div>    <footer class="nav-footer" id="footer">
    <section class="sitemap"><a href="https://developers.libra.org/" class="nav-home"><img
          src="libra-logomark-white.png" alt="Libra" /></a>
      <div class="footerSection">
        <h5>Learn About Libra</h5><a href="welcome-to-libra.htm">Welcome to Libra</a><a
          href="libra-protocol.htm">Libra Protocol</a><a href="the-libra-blockchain-paper.htm">Libra Blockchain</a><a
          href="life-of-a-transaction.htm">Life of a Transaction</a>
        <p></p>
        <h5>Try Libra Core </h5><a href="my-first-transaction.htm">My First Transaction</a><a
          href="move-overview.htm">Getting Started With Move</a>
      </div>
      <div class="footerSection">
        <h5>Policies</h5><a href="privacy-policy.htm">Privacy Policy</a><a href="terms-of-use.htm">Terms of Use</a><a
          href="cookies-policy.htm">Cookies Policy</a><a href="code-of-conduct.htm">Code of Conduct</a>
        <p></p>
        <h5>Community</h5><a href="https://community.libra.org/">Developer Forum</a><a
          href="https://developers.libra.org/newsletter_form">Newsletter</a>
      </div>
      <div class="footerSection">
        <h5>Libra Developer Community</h5>
        <img style="width:300px" src='qr_violas.png'>
        <h5>Join us with scan and enter libra<h5>
      </div>
    </section>
    <section class="copyright"> © Violas Association</section>
  </footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: '0d48ee629d39ddc4916eeef7755a0c4c',
                indexName: 'libra',
                inputSelector: '#search_input_react'
              });
            </script></body></html>